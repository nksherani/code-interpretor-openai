# API Documentation

Complete API reference for the OpenAI Code Interpreter Explorer backend.

Base URL: `http://localhost:8000`

## Table of Contents

- [Overview](#overview)
- [Authentication](#authentication)
- [Endpoints](#endpoints)
  - [Health Check](#health-check)
  - [Thread Management](#thread-management)
  - [Chat Operations](#chat-operations)
  - [File Operations](#file-operations)
  - [Data Analysis](#data-analysis)
  - [Examples](#examples)
- [Models](#models)
- [Error Handling](#error-handling)

## Overview

The API is built with FastAPI and provides RESTful endpoints for interacting with OpenAI's Code Interpreter through the Assistants API.

**Features:**
- Thread-based conversations
- File upload and processing
- Code execution and analysis
- Data visualization generation
- Pre-built example scenarios

## Authentication

The API uses OpenAI API keys configured server-side. No authentication is required for API endpoints in this implementation (suitable for local development).

**For production deployment**, implement proper authentication:
- API keys
- OAuth2
- JWT tokens

## Endpoints

### Health Check

#### GET `/`

Check if the API is running.

**Response:**
```json
{
  "message": "OpenAI Code Interpreter Explorer API"
}
```

---

### Thread Management

#### POST `/api/thread/create`

Create a new conversation thread.

**Response:**
```json
{
  "thread_id": "thread_abc123",
  "status": "created"
}
```

**Status Codes:**
- `200`: Success
- `500`: Server error

---

#### GET `/api/thread/{thread_id}/messages`

Get all messages from a conversation thread.

**Parameters:**
- `thread_id` (path): The thread identifier

**Response:**
```json
{
  "messages": [
    {
      "id": "msg_abc123",
      "role": "user",
      "content": "Calculate fibonacci numbers",
      "annotations": [],
      "created_at": 1234567890
    },
    {
      "id": "msg_def456",
      "role": "assistant",
      "content": "Here are the first 10 Fibonacci numbers...",
      "annotations": [],
      "created_at": 1234567891
    }
  ]
}
```

---

### Chat Operations

#### POST `/api/chat`

Send a message and receive an AI response with code execution.

**Request Body:**
```json
{
  "message": "Create a bar chart showing sales data",
  "thread_id": "thread_abc123",  // optional
  "use_code_interpreter": true
}
```

**Response:**
```json
{
  "thread_id": "thread_abc123",
  "message": "I've created a bar chart showing the sales data...",
  "files": [
    {
      "file_id": "file-abc123",
      "type": "image_file"
    }
  ],
  "annotations": [
    {
      "type": "file_path",
      "file_id": "file-abc123",
      "text": "sales_chart.png"
    }
  ]
}
```

**Status Codes:**
- `200`: Success
- `500`: Server error or run failed

---

### File Operations

#### POST `/api/upload`

Upload a file for use with Code Interpreter.

**Request:**
- Content-Type: `multipart/form-data`
- Body: `file` (binary)

**Supported formats:**
- CSV (`.csv`)
- Excel (`.xlsx`, `.xls`)
- JSON (`.json`)
- Text (`.txt`)
- PDF (`.pdf`)

**Response:**
```json
{
  "file_id": "file-abc123",
  "filename": "data.csv",
  "status": "uploaded"
}
```

**Status Codes:**
- `200`: Success
- `500`: Upload failed

---

#### GET `/api/file/{file_id}`

Download a file generated by Code Interpreter.

**Parameters:**
- `file_id` (path): The file identifier from OpenAI

**Response:**
- Binary file content
- Content-Type: `application/octet-stream`
- Content-Disposition: `attachment; filename="output_{file_id}.png"`

**Status Codes:**
- `200`: Success
- `500`: Download failed

---

### Data Analysis

#### POST `/api/analyze`

Perform data analysis with optional file attachments.

**Request Body:**
```json
{
  "prompt": "Analyze this dataset and show correlations",
  "file_ids": ["file-abc123", "file-def456"],
  "thread_id": "thread_abc123"  // optional
}
```

**Response:**
```json
{
  "thread_id": "thread_abc123",
  "message": "Analysis complete. Here are the findings...",
  "files": [
    {
      "file_id": "file-xyz789",
      "type": "image_file"
    }
  ],
  "annotations": []
}
```

---

### Examples

Pre-built examples demonstrating Code Interpreter capabilities.

#### POST `/api/examples/data-analysis`

Generate sample sales data and perform comprehensive analysis.

**Response:**
```json
{
  "thread_id": "thread_abc123",
  "message": "Generated 100 sales records...",
  "files": [
    {
      "file_id": "file-chart123",
      "type": "image_file"
    }
  ],
  "annotations": []
}
```

**What it does:**
- Generates 100 sales records
- Calculates revenue by product
- Finds best performing region
- Creates time-series visualization
- Provides summary statistics

---

#### POST `/api/examples/math-computation`

Perform various mathematical computations.

**Response:**
```json
{
  "thread_id": "thread_def456",
  "message": "Mathematical computations complete...",
  "files": [
    {
      "file_id": "file-plot123",
      "type": "image_file"
    }
  ],
  "annotations": []
}
```

**What it does:**
- Calculates first 20 Fibonacci numbers
- Finds prime numbers between 1-100
- Solves polynomial equations
- Creates mathematical plots

---

#### POST `/api/examples/image-generation`

Generate various data visualizations.

**Response:**
```json
{
  "thread_id": "thread_ghi789",
  "message": "Created visualizations...",
  "files": [
    {
      "file_id": "file-heatmap123",
      "type": "image_file"
    },
    {
      "file_id": "file-3dplot456",
      "type": "image_file"
    },
    {
      "file_id": "file-pie789",
      "type": "image_file"
    }
  ],
  "annotations": []
}
```

**What it does:**
- Creates correlation heatmap
- Generates 3D surface plot
- Builds pie chart
- Exports as downloadable images

---

## Models

### ChatRequest

```typescript
{
  message: string;           // Required: User message
  thread_id?: string;        // Optional: Existing thread ID
  use_code_interpreter: boolean;  // Use Code Interpreter tool
}
```

### AnalysisRequest

```typescript
{
  prompt: string;           // Required: Analysis instructions
  file_ids: string[];       // Optional: Uploaded file IDs
  thread_id?: string;       // Optional: Existing thread ID
}
```

### ThreadResponse

```typescript
{
  thread_id: string;        // Thread identifier
  message: string;          // AI response text
  files: Array<{           // Generated files
    file_id: string;
    type: string;          // "image_file" | "file_path"
  }>;
  annotations: Array<{     // Content annotations
    type: string;
    file_id: string;
    text?: string;
  }>;
}
```

## Error Handling

All endpoints return errors in the following format:

```json
{
  "detail": "Error message describing what went wrong"
}
```

### Common Status Codes

- `200 OK`: Request successful
- `400 Bad Request`: Invalid request parameters
- `500 Internal Server Error`: Server-side error (OpenAI API, processing, etc.)

### Error Examples

**Missing API Key:**
```json
{
  "detail": "OpenAI API key not configured"
}
```

**Run Failed:**
```json
{
  "detail": "Run failed"
}
```

**File Upload Error:**
```json
{
  "detail": "Error uploading file: [specific error]"
}
```

## Rate Limits

The API is subject to OpenAI's rate limits:

- **Requests per minute**: Varies by plan
- **Tokens per minute**: Varies by plan
- **Code Interpreter executions**: May take several seconds

**Best practices:**
- Implement exponential backoff for retries
- Cache results when possible
- Monitor rate limit headers (if implemented)

## Interactive Documentation

FastAPI provides interactive API documentation:

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

These interfaces allow you to:
- View all endpoints
- See request/response schemas
- Test endpoints directly in browser
- Download OpenAPI specification

## Code Examples

### Python

```python
import requests

# Send a chat message
response = requests.post(
    "http://localhost:8000/api/chat",
    json={
        "message": "Calculate the first 10 prime numbers",
        "use_code_interpreter": True
    }
)
data = response.json()
print(data["message"])
```

### JavaScript

```javascript
// Upload a file
const formData = new FormData();
formData.append('file', fileInput.files[0]);

const response = await fetch('http://localhost:8000/api/upload', {
  method: 'POST',
  body: formData
});

const data = await response.json();
console.log(data.file_id);
```

### cURL

```bash
# Create a thread
curl -X POST http://localhost:8000/api/thread/create

# Send a message
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Show me Fibonacci numbers",
    "use_code_interpreter": true
  }'
```

## WebSocket Support

Currently not implemented. The API uses HTTP polling.

**Future enhancement**: Add WebSocket support for:
- Real-time updates during code execution
- Streaming responses
- Live progress indicators

## Webhooks

Currently not implemented.

**Future enhancement**: Add webhook support for:
- Async job completion notifications
- Long-running analysis results
- Error notifications

## Version History

- **v0.0.1** (Current)
  - Initial release
  - Basic chat, file upload, analysis
  - Pre-built examples
  - Thread management

## Support

For issues or questions:
1. Check this documentation
2. Review the main README.md
3. Check interactive docs at `/docs`
4. Submit an issue on GitHub

---

**Last Updated**: December 2025


